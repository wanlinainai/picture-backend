## 用户传图
> 在进行用户的URL上传图片操作中，需要注意的问题是：
> 1. 验证URL格式
> 2. 校验URL协议
> 3. 发送HEAD请求验证文件是否存在
> 4. 校验文件类型
> 5. 校验文件大小

### 由于这个根据URL上传图片的功能跟之前的 文件上传有很多相似之处，我们还需要将这个进行拆分
#### 模版方法

## 缓存优化
1. 高频访问的数据：如首页、热门推荐内容
2. 计算成本较高的数据：如复杂查询结果，大量数据的统计结果
3. 允许短时间延迟的数据：排行榜、图片列表等
### Redis分布式缓存
### 本地缓存caffeine

## 图片上传优化
### 图片压缩
#### WebP：相较于PNG文件来说小了大约26%，比JPEG文件小25-34%
#### AVIF：基于AV1视频编码格式图片压缩，压缩率更高。但是兼容性会差一些

## 文件秒传
### 实现方案
（1） 客户端生成文件唯一标识：上传前，通过客户端计算文件的哈希值（MD5、SHA-256），生成唯一指纹。<br>
（2） 服务端校验文件指纹：后端接收到文件指纹之后，在存储中查询是否已存在相同文件。
- 存在相同文件，直接返回文件的存储路径。
- 不存在文件，接收到文件指纹并存储文件，同时记录其指纹信息。
### 问题
文件重复比较小，重复文件很少，另一个是用到了第三方存储，只能通过唯一地址去访问提取文件，无法完全自定义文件的存储结构、不支持文件快捷方式等概念，因此秒传文件地址必须使用和原本文件相同的路径对象路径，比如：用户A上传的图片地址等于用户B上传的图片地址。
## 分片上传和断点续传
对于大文件，可以自己选择分片上传或者断点续传。COS服务中有这个服务。

## 空间部分修改
### 空间级别和限额控制
目前的上传图片的功能已经比较复杂了，如果要增加一个新的校验规则，免不了要重新修改代码，但是在屎山上拉屎不是我们的风格。
当技术实现比较复杂的时候，不妨考虑一下对业务进行优化。
比如：
- 单张图片最大才2MB，那么即时空间已经满了在允许用户上传一张图片又有何妨呢？
- 即使用户在超额限制之前瞬间上传了大量的图片，但是对系统的影响并不大。后续可以通过限流 + 定时任务检测空间等策略。

## 图片功能扩展
- 图片扩展
- 基础属性搜索
- 以图搜图
- 颜色搜索
- 图片分享
- 链接分享
- 扫码分享
- 图片批量管理
- 批量修改信息
- 批量重命名

### 以图搜图
